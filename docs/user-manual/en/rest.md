# Kapua REST API

Kapua exposes REST API which can be used to access Kapua data and invoke Kapua operations. REST API application is running as a dedicated
Java process.

In order to access API application in OpenShift environment, you need to access API service IP. In order to retrieve REST API IP address, 
execute the following command:

    $ oc get service | grep api
    kapua-api       172.30.200.124   <none>        8080/TCP             1d

In order to retrieve a list of API operations, you can use Swagger UI available the following URL - `http://RESTAPIADDRESSS:8080/doc`.

![REST API page](images/rest-api.png)

## Logging into Kapua REST API

Before you start to work with REST API, you need to authenticate yourself and receive session token which you will then pass together with every 
subsequent invocation of REST API. The easiest way to receive token is by using Swagger UI which will generate CURL command for you: 

    http://RESTAPIADDRESSS:8080/doc/#!/Authentication/loginUsernamePassword

You can use default Kapua admin username/password pair i.e. `kapua-sys/kapua-password`. This is the CURL request command generated by Swagger UI:
    
```
curl -X POST --header 'Content-Type: application/json' --header 'Accept: application/json' -d '{
  "password": [
    "kapua-password"
  ],
  "username": "kapua-sys"
}' 'http://RESTAPIADDRESSS:8080/v1/authentication/user'
```

The CURL command above should generate response similar to the snippet below:

```
{
  "type": "accessTokenImpl",
  "createdBy": {},
  "createdOn": "2017-03-24T15:02:20.736Z",
  "id": {},
  "scopeId": {},
  "entityAttributes": {
    "entry": []
  },
  "entityProperties": {
    "entry": []
  },
  "modifiedBy": {},
  "modifiedOn": "2017-03-24T15:02:20.736Z",
  "optlock": 1,
  "expiresOn": "2017-03-24T15:32:20.728Z",
  "refreshExpiresOn": "2017-03-24T20:02:20.728Z",
  "refreshToken": "07194658-db17-4314-ab58-49ddbf259f44",
  "tokenId": "eyJhbGciOiJSUzI1NiJ9.eyJpc3MiOiJodHRwczovL3d3dy5lY2xpcHNlLm9yZy9rYXB1YSIsImlhdCI6MTQ5MDM2Nzc0MCwiZXhwIjoxNDkwMzY5NTQwLCJzdWIiOiJBUSIsInNJZCI6IkFRIn0.HA3cgNUPK3LJbziP7ZVjke8dLS5xVKj3RuhjFPoJYUNVyo7MxH-1Wiuls7X4LV-PZWjR_Y3wjuwiVopED22FGNUc_fzXhZIb69Ifod6lE0lTCYABDMc7RwQOEdqTlqUv2NiprZ3-VAMYYlvjEJQD_s2EN2vyikXCPXc9MIU8pDVKOwhu1EjZC9X7vTUyMnwbNcoAKp0uI5-rdDuyTZDoS6r82gp69wJ5HIwxa8r1MZxbmTCP-HaaZ29J7YfI-RYGoVzbUOsOQV725xUKhzVJEhtyFlt38-Xuevac6JayyErd06lWR1wLgHwjAQWLuy-G2tuq10lEzj3GuDhnyIihlg",
  "userId": {}
}
```

The token itself is located under `tokenId` key. You can use your token by adding `Authorization: Bearer YOUR_TOKEN` HTTP header to the API call. For
example the snippet below uses retrieved token to list users available for current tenant:

```
curl -X GET --header 'Authorization: Bearer eyJhbGciOiJSUzI1NiJ9.eyJpc3MiOiJodHRwczovL3d3dy5lY2xpcHNlLm9yZy9rYXB1YSIsImlhdCI6MTQ5MDM2Nzc0MCwiZXhwIjoxNDkwMzY5NTQwLCJzdWIiOiJBUSIsInNJZCI6IkFRIn0.HA3cgNUPK3LJbziP7ZVjke8dLS5xVKj3RuhjFPoJYUNVyo7MxH-1Wiuls7X4LV-PZWjR_Y3wjuwiVopED22FGNUc_fzXhZIb69Ifod6lE0lTCYABDMc7RwQOEdqTlqUv2NiprZ3-VAMYYlvjEJQD_s2EN2vyikXCPXc9MIU8pDVKOwhu1EjZC9X7vTUyMnwbNcoAKp0uI5-rdDuyTZDoS6r82gp69wJ5HIwxa8r1MZxbmTCP-HaaZ29J7YfI-RYGoVzbUOsOQV725xUKhzVJEhtyFlt38-Xuevac6JayyErd06lWR1wLgHwjAQWLuy-G2tuq10lEzj3GuDhnyIihlg' --header 'Accept: application/json' 'http://172.30.131.13:8080/v1/_/users?offset=0&limit=50'
{"type":"userListResult","limitExceeded":false,"size":2,"items":{"item":[{"type":"user","id":"Ag","scopeId":"AQ","createdOn":"2017-03-24T14:48:03.686Z","createdBy":"AQ","modifiedOn":"2017-03-24T14:48:03.686Z","modifiedBy":"AQ","optlock":0,"name":"kapua-broker","status":"ENABLED","displayName":"Kapua Broker","email":"kapua-broker@eclipse.org","phoneNumber":"+1 555 123 4567","userType":"INTERNAL"},{"type":"user","id":"AQ","scopeId":"AQ","createdOn":"2017-03-24T14:48:03.686Z","createdBy":"AQ","modifiedOn":"2017-03-24T14:48:03.686Z","modifiedBy":"AQ","optlock":0,"name":"kapua-sys","status":"ENABLED","displayName":"Kapua Sysadmin","email":"kapua-sys@eclipse.org","phoneNumber":"+1 555 123 4567","userType":"INTERNAL"}]}}
```